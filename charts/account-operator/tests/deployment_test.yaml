suite: operator
chart:
  appVersion: 0.0.0
tests:
  - it: operator match the snapshot
    asserts:
      - matchSnapshot: {}
  - it: operator match the snapshot (with kubeconfigSecret)
    set:
      kubeconfigSecret: "kubeconfig"
    asserts:
      - matchSnapshot: {}
  - it: operator match the snapshot with webhook enabled
    set:
      webhooks:
        enabled: true
    asserts:
      - matchSnapshot: {}
  - it: deployment with security context
    template: deployment.yaml
    asserts:
      - equal:
          path: spec.template.spec.containers[0].securityContext
          value:
            runAsNonRoot: true
            readOnlyRootFilesystem: true
            seccompProfile:
              type: RuntimeDefault
      - equal:
          path: spec.template.spec.containers[0].serviceAccountName
          value: RELEASE-NAME
      - equal:
          path: spec.template.spec.containers[0].automountServiceAccountToken
          value: true
