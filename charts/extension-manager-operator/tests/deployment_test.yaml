suite: operator
templates:
  - deployment.yaml
  - service-account.yaml
  - cluster-role.yaml
  - cluster-rolebinding.yaml
values:
  - ../test-values.yaml
chart:
  version: 1.0.0
  appVersion: 1.0.0
tests:
  - it: operator match the snapshot
    asserts:
      - matchSnapshot: {}
    set:
      istio:
        enabled: true
  - it: deployment with metrics probes
    template: deployment.yaml
    set:
      health:
        port: 8081
      metrics:
        port: 8082
    asserts:
      - equal:
          path: spec.template.spec.containers[0].livenessProbe
          value:
            failureThreshold: 1
            httpGet:
              path: /healthz
              port: 8081
            periodSeconds: 10
